-
  - values # values
  - serial: True # run test cases in serial mode
  - parallel: True # run test cases in parallel mode
  - local: True # run test cases in local mode
  - s3: True # run test cases in s3 mode
  - [simple.py: &simple
      $CODEBUILD_SRC_DIR/examples/tensorflow/scripts/simple.py,
     tf_mnist.py: &tf_mnist
      $CODEBUILD_SRC_DIR/examples/tensorflow/scripts/mnist.py,
     torch_simple.py: &torch_simple
      $CODEBUILD_SRC_DIR/examples/pytorch/scripts/simple.py,
     train_imagenet_resnet_hvd.py: &train_imagenet_resnet_hvd
      $CODEBUILD_SRC_DIR/examples/tensorflow/scripts/train_imagenet_resnet_hvd.py,
     mnist_gluon_basic_hook_demo.py: &mnist_gluon_basic_hook_demo
      $CODEBUILD_SRC_DIR/examples/mxnet/scripts/mnist_gluon_basic_hook_demo.py,
     mnist_gluon_all_zero_demo.py: &mnist_gluon_all_zero_demo
      $CODEBUILD_SRC_DIR/examples/mxnet/scripts/mnist_gluon_all_zero_demo.py,
     mnist_gluon_vg_demo.py: &mnist_gluon_vg_demo
      $CODEBUILD_SRC_DIR/examples/mxnet/scripts/mnist_gluon_vg_demo.py,
     test_check_input_images.py: &test_check_input_images
      $CODEBUILD_SRC_DIR/tests/analysis/rules/test_check_input_images.py,
     test_dead_relu.py: &test_dead_relu
      $CODEBUILD_SRC_DIR/tests/analysis/rules/test_dead_relu.py,
     xgboost_mnist_basic_hook_demo.py: &xgboost_mnist_basic_hook_demo
      $CODEBUILD_SRC_DIR/examples/xgboost/scripts/xgboost_mnist_basic_hook_demo.py,
     invoker.py: &invoker
      $CODEBUILD_SRC_DIR/tests/analysis/invoker.py,
     Enable: &Enable # enable the test case
       True,
     Disable: &Disable # disable the test case
       False,
    ]
# test cases for xgboost
-
  - tree_depth/xgboost/true
  - xgboost
  - *Disable
  - [*xgboost_mnist_basic_hook_demo,
     --max_depth 100,
     *invoker,
     --rule_name treedepth --flag True --end_step 0
    ]
-
  - tree_depth/xgboost/false
  - xgboost
  - *Disable
  - [*xgboost_mnist_basic_hook_demo,
     --max_depth 4 --num_round 10,
     *invoker,
     --rule_name treedepth --flag False --end_step 9
    ]
-
  - class_imbalance/xgboost/true
  - xgboost
  - *Enable
  - [*xgboost_mnist_basic_hook_demo,
      --save_frequency 1,
     *invoker,
     --rule_name classimbalance --flag True --end_step 9
    ]

# test cases for tensorflow
-
  - exploding_tensor/tf/false
  - tensorflow
  - *Enable
  - [*simple,
     --lr 0.001 --scale 1 --steps 68 --save_frequency 13 --random_seed True,
     *invoker,
     --rule_name explodingtensor --flag False --end_step 66 --collection_names gradients,weights
    ]
-
  - exploding_tensor/tf/true
  - tensorflow
  - *Enable
  - [*simple,
     --lr 1000000000000 --scale 10000000000000 --save_frequency 9 --steps 66 --random_seed True,
     *invoker,
     --rule_name explodingtensor --flag True --end_step 64 --collection_names gradients,weights
    ]

-
  - vanishing_grad/tf/false
  - tensorflow
  - *Enable
  - [*simple,
     --lr 0.001 --scale 1 --steps 68 --save_frequency 13 --random_seed True,
     *invoker,
     --rule_name vanishinggradient --flag False --end_step 66
    ]
-
  - vanishing_grad/tf/true
  - tensorflow
  - *Disable # tested on remote ubuntu machine with tensorflow_p36 venv
  - [*train_imagenet_resnet_hvd, # this training script will generate 190 steps
     --clear_log --enable_smdebug --save_weights --save_gradients
     --step_interval 10 --constant_initializer 0.01 --random_seed True,
     *invoker,
     --rule_name vanishinggradient --flag True --end_step 181
    ]

-
  - weight_update_ratio/tf/false
  - tensorflow
  - *Enable
  - [*simple,
     --lr 0.001 --scale 1 --steps 75 --save_frequency 1 --random_seed True,
     *invoker,
     --rule_name weightupdateratio --flag False --end_step 71
    ]
-
  - weight_update_ratio/tf/true
  - tensorflow
  - *Enable
  - [*simple,
     --lr 0.0000000001 --scale 1 --steps 75 --save_frequency 1 --random_seed True,
     *invoker,
     --rule_name weightupdateratio --flag True --end_step 71
    ]
-
  - loss_not_decreasing/tf/true
  - tensorflow
  - *Disable
  - [*tf_mnist,
     --lr 0.001 --train_frequency 10 --random_seed True --num_steps 100,
     *invoker,
     --rule_name lossnotdecreasing --flag True --end_step 100
    ]
-
  - loss_not_decreasing/tf/false
  - tensorflow
  - *Disable
  - [*simple,
     --lr 0.05 --scale 1 --steps 1009 --save_frequency 13 --random_seed True,
     *invoker,
     --rule_name lossnotdecreasing --flag False --end_step 50 --diff_percent 50
    ]

# test cases for mxnet
-
  - exploding_tensor/mxnet/false
  - mxnet
  - *Enable
  - [*mnist_gluon_basic_hook_demo,
     --random_seed True --num_steps 6,
     *invoker,
     --rule_name explodingtensor --flag False --end_step 4 --collection_names gradients,weights
    ]
-
  - exploding_tensor/mxnet/true
  - mxnet
  - *Enable
  - [*mnist_gluon_basic_hook_demo,
     --learning_rate 1000000000 --random_seed True --num_steps 6,
     *invoker,
     --rule_name explodingtensor --flag True --end_step 4 --collection_names gradients,weights
    ]

-
  - vanishing_grad/mxnet/false
  - mxnet
  - *Enable
  - [*mnist_gluon_basic_hook_demo,
     --random_seed True --num_steps 6,
     *invoker,
     --rule_name vanishinggradient --flag False --end_step 4
    ]
-
  - vanishing_grad/mxnet/true
  - mxnet
  - *Enable
  - [*mnist_gluon_vg_demo, # this training script will generate 1300 steps
     --random_seed True --num_steps 33 --save_frequency 30,
     *invoker,
     --rule_name vanishinggradient --flag True --start_step 1 --end_step 31
    ] # notice, step 0 always returns False

-
  - weight_update_ratio/mxnet/false
  - mxnet
  - *Enable
  - [*mnist_gluon_basic_hook_demo,
     --random_seed True --num_steps 6,
     *invoker,
     --rule_name weightupdateratio --flag False --end_step 4
    ]
-
  - weight_update_ratio/mxnet/true
  - mxnet
  - *Enable
  - [*mnist_gluon_basic_hook_demo,
     --learning_rate 0.0000000001 --random_seed True --num_steps 6,
     *invoker,
     --rule_name weightupdateratio --flag True --end_step 4
    ]
-
  - all_zero/mxnet/false
  - mxnet
  - *Enable
  - [*mnist_gluon_basic_hook_demo,
     --random_seed True --num_steps 5,
     *invoker,
     --rule_name allzero --flag False --end_step 3 --collection_names weights
    ]
-
  - all_zero/mxnet/true
  - mxnet
  - *Enable
  - [*mnist_gluon_all_zero_demo,
     --random_seed True --num_steps 5,
     *invoker,
     --rule_name allzero --flag True --end_step 3 --collection_names ReluActivation
    ]
-
  - check_input_images/mxnet/true
  - mxnet
  - *Enable
  - [*test_check_input_images,
     --flag True,
     *invoker,
     --rule_name checkinputimages --flag True --end_step 7 --collection_names input
    ]
-
  - check_input_images/mxnet/false
  - mxnet
  - *Enable
  - [*test_check_input_images,
     --flag False,
     *invoker,
     --rule_name checkinputimages --flag False --end_step 936 --collection_names input
    ]
-
  - dead_relu/mxnet/true
  - mxnet
  - *Enable
  - [*test_dead_relu,
     --flag True,
     *invoker,
     --rule_name deadrelu --flag True --end_step 0 --collection_names ReluActivation
    ]
-
  - dead_relu/mxnet/false
  - mxnet
  - *Enable
  - [*test_dead_relu,
     --flag False,
     *invoker,
     --rule_name deadrelu --flag False --end_step 4 --collection_names ReluActivation
    ]

    # test cases for pytorch
-
  - exploding_tensor/pytorch/false
  - pytorch
  - *Enable
  - [*torch_simple,
     --lr .01 --momentum 0.8 --save-frequency 15 --steps 46 --hook-type saveall --random-seed True,
     *invoker,
     --rule_name explodingtensor --end_step 46  --flag False --collection_names gradients,weights
    ]
-
  - exploding_tensor/pytorch/true
  - pytorch
  - *Enable
  - [*torch_simple,
     --lr 1000000.0 --momentum 10 --save-frequency 8 --steps 20 --hook-type saveall --random-seed True,
     *invoker,
     --rule_name explodingtensor --end_step 20 --flag True --collection_names gradients,weights
    ]
-
  - vanishing_grad/pytorch/false
  - pytorch
  - *Enable
  - [*torch_simple,
     --lr .01 --momentum 0.9 --save-frequency 3 --steps 10 --hook-type saveall --random-seed True,
     *invoker,
     --rule_name vanishinggradient --end_step 10 --flag False
    ]
-
  - vanishing_grad/pytorch/true
  - pytorch
  - *Enable # tested on remote ubuntu machine with tensorflow_p36 venv
  - [*torch_simple, # this training script will generate 100 steps
     --lr 1.0 --momentum 0.9 --save-frequency 3 --steps 10 --hook-type saveall --random-seed True,
     *invoker,
     --rule_name vanishinggradient --end_step 10 --flag True
    ]
-
  - weight_update_ratio/pytorch/false
  - pytorch
  - *Enable
  - [*torch_simple,
     --lr .0001 --momentum 0.08 --save-frequency 1 --steps 15 --hook-type saveall --random-seed True,
     *invoker,
     --rule_name weightupdateratio --start_step 8 --end_step 15 --flag False
    ]
-
  - weight_update_ratio/pytorch/true
  - pytorch
  - *Enable
  - [*torch_simple,
     --lr .0000000000001 --momentum .000001 --save-frequency 1 --steps 15 --hook-type saveall --random-seed True,
     *invoker,
     --rule_name weightupdateratio --start_step 8 --end_step 15 --flag True
    ]
